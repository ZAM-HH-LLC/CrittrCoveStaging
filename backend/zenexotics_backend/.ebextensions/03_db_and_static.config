files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_check_database.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Check if the database connection is working
      source /var/app/venv/*/bin/activate
      cd /var/app/current
      if python -c "import os; import django; os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'zenexotics_backend.settings'); django.setup(); from django.db import connection; connection.cursor()"; then
        echo "Database connection successful"
        exit 0
      else
        echo "Database connection failed"
        echo "Please check your environment variables and database settings"
        # We exit with 0 to not fail deployment - you may want to change this to 1 in production
        exit 0
      fi

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_ALLOWED_HOSTS: ".elasticbeanstalk.com,localhost,127.0.0.1"
  aws:elasticbeanstalk:container:python:
    NumProcesses: 3
    NumThreads: 20
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx 